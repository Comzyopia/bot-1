<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Ultra Trading Bot - TIMEFRAMES DISPONIBLES</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .trading-card { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            transition: all 0.3s ease;
        }
        .trading-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .timeframe-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div x-data="ultimateTradingBot()" x-init="init()">
        <!-- Header Am√©lior√© -->
        <header class="gradient-bg px-6 py-4 shadow-2xl">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                            <i class="fas fa-robot text-2xl text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold">üöÄ Ultra Trading Bot</h1>
                            <p class="text-sm opacity-80">VERSION CORRIG√âE - 9 TIMEFRAMES DISPONIBLES</p>
                        </div>
                    </div>
                    
                    <!-- Status avec Vraies Valeurs -->
                    <div class="flex items-center space-x-6">
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 rounded-full pulse" :class="mt5Connected ? 'bg-green-400' : 'bg-red-400'"></div>
                            <span class="font-medium" x-text="mt5Connected ? 'MT5 Connect√© ‚úÖ' : 'MT5 D√©connect√© ‚ùå'"></span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 rounded-full pulse" :class="autoTrading ? 'bg-green-400' : 'bg-gray-400'"></div>
                            <span class="font-medium" x-text="autoTrading ? 'Trading Auto ‚úÖ' : 'Trading Arr√™t√© ‚è∏Ô∏è'"></span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 rounded-full pulse" :class="realAccount ? 'bg-green-400' : 'bg-yellow-400'"></div>
                            <span class="font-medium" x-text="realAccount ? 'Compte R√©el üí∞' : 'Mode D√©mo üéØ'"></span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Section Timeframes - NOUVEAU -->
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="trading-card rounded-xl p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6 text-center">‚è∞ S√âLECTION TIMEFRAME</h2>
                <div class="timeframe-grid">
                    <template x-for="tf in timeframes" :key="tf.value">
                        <div class="trading-card rounded-lg p-4 cursor-pointer hover:bg-opacity-20" 
                             :class="config.timeframe === tf.value ? 'ring-2 ring-blue-500 bg-blue-500 bg-opacity-20' : ''"
                             @click="selectTimeframe(tf.value)">
                            <div class="text-center">
                                <div class="text-2xl font-bold mb-2" x-text="tf.value"></div>
                                <div class="text-sm font-medium mb-1" x-text="tf.label"></div>
                                <div class="text-xs text-gray-400" x-text="tf.description"></div>
                                <div class="mt-2" x-show="config.timeframe === tf.value">
                                    <span class="inline-block px-2 py-1 bg-blue-500 text-white text-xs rounded-full">S√âLECTIONN√â</span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                <div class="text-center mt-6">
                    <div class="text-lg font-bold text-blue-400">
                        Timeframe Actuel: <span x-text="config.timeframe" class="text-white"></span>
                    </div>
                    <div class="text-sm text-gray-400">
                        <span x-text="getCurrentTimeframeDescription()"></span>
                    </div>
                </div>
            </div>

            <!-- Configuration Trading - AM√âLIOR√âE -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Connexion MT5 -->
                <div class="trading-card rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4">üîå Connexion MT5</h3>
                    <div class="space-y-4">
                        <input x-model="mt5Config.login" type="number" placeholder="Login (ex: 1296306)" 
                               class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                        <input x-model="mt5Config.password" type="password" placeholder="Mot de passe" 
                               class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                        <input x-model="mt5Config.server" type="text" placeholder="Serveur (ex: FreshForex-MT5)" 
                               class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                        <button @click="connectMT5()" :disabled="connecting" 
                                class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded-lg font-bold text-lg transition-colors">
                            <span x-show="!connecting">üöÄ CONNECTER MT5</span>
                            <span x-show="connecting">‚è≥ Connexion...</span>
                        </button>
                    </div>
                </div>

                <!-- Configuration Risque - AM√âLIOR√âE -->
                <div class="trading-card rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-4">‚ö†Ô∏è Gestion Risque</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Risque par Trade</label>
                            <select x-model="config.risk_per_trade" @change="updateConfig()" 
                                    class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-green-500 focus:outline-none">
                                <option value="0.005">0.5% - Ultra Conservateur</option>
                                <option value="0.01">1% - Conservateur</option>
                                <option value="0.02">2% - Mod√©r√©</option>
                                <option value="0.03">3% - √âquilibr√©</option>
                                <option value="0.05">5% - Agressif</option>
                                <option value="0.1">10% - Tr√®s Agressif</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Positions Maximum</label>
                            <select x-model="config.max_positions" @change="updateConfig()" 
                                    class="w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg focus:border-green-500 focus:outline-none">
                                <option value="1">1 Position</option>
                                <option value="2">2 Positions</option>
                                <option value="3">3 Positions</option>
                                <option value="5">5 Positions</option>
                                <option value="10">10 Positions</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input x-model="config.take_trades" type="checkbox" @change="updateConfig()" class="w-4 h-4 text-green-500">
                            <label class="text-sm font-medium">‚úÖ Autoriser les Trades R√©els</label>
                        </div>
                    </div>
                </div>

                <!-- Informations Compte - VRAIES VALEURS -->
                <div class="trading-card rounded-xl p-6" x-show="accountInfo">
                    <h3 class="text-lg font-semibold mb-4">üí∞ Informations Compte</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Solde:</span>
                            <span class="font-bold text-2xl text-green-400" x-text="formatCurrency(accountInfo?.balance || 0)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">√âquit√©:</span>
                            <span class="font-bold text-blue-400" x-text="formatCurrency(accountInfo?.equity || 0)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Marge:</span>
                            <span class="font-bold text-yellow-400" x-text="formatCurrency(accountInfo?.margin || 0)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Libre:</span>
                            <span class="font-bold text-purple-400" x-text="formatCurrency(accountInfo?.margin_free || 0)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Levier:</span>
                            <span class="font-bold text-orange-400" x-text="'1:' + (accountInfo?.leverage || 0)"></span>
                        </div>
                        <div class="text-center mt-4">
                            <div class="text-sm text-gray-400">Compte:</div>
                            <div class="font-bold text-lg" x-text="accountInfo?.login || 'Non connect√©'"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contr√¥les Trading - AM√âLIOR√âS -->
            <div class="trading-card rounded-xl p-6 mb-8">
                <div class="flex flex-wrap gap-4 justify-center">
                    <button @click="startTrading()" :disabled="!mt5Connected || autoTrading" 
                            class="px-8 py-4 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-bold text-lg transition-colors">
                        <i class="fas fa-rocket mr-2"></i>
                        <span x-text="autoTrading ? '‚úÖ TRADING ACTIF' : 'üöÄ D√âMARRER TRADING'"></span>
                    </button>
                    <button @click="stopTrading()" :disabled="!autoTrading" 
                            class="px-8 py-4 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-bold text-lg transition-colors">
                        <i class="fas fa-stop mr-2"></i>
                        ARR√äTER TRADING
                    </button>
                    <button @click="analyzeAll()" :disabled="!mt5Connected" 
                            class="px-8 py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-bold text-lg transition-colors">
                        <i class="fas fa-chart-line mr-2"></i>
                        ANALYSER MARCH√â
                    </button>
                </div>
            </div>

            <!-- Analyses de March√© - AM√âLIOR√âES -->
            <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">
                <template x-for="analysis in analyses" :key="analysis.symbol">
                    <div class="trading-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold" x-text="analysis.symbol"></h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 rounded-full" :class="getActionColor(analysis.action)"></div>
                                <span class="text-sm font-bold" x-text="analysis.action"></span>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">Prix:</span>
                                <span class="font-bold text-lg" x-text="analysis.current_price?.toFixed(5)"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">Timeframe:</span>
                                <span class="font-bold text-purple-400" x-text="analysis.timeframe"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">Confiance:</span>
                                <span class="font-bold" x-text="(analysis.confidence * 100).toFixed(1) + '%'"></span>
                            </div>
                            
                            <!-- Barre de confiance -->
                            <div class="w-full bg-gray-700 rounded-full h-3">
                                <div class="h-3 rounded-full transition-all duration-300" 
                                     :class="getConfidenceColor(analysis.confidence)"
                                     :style="'width: ' + (analysis.confidence * 100) + '%'"></div>
                            </div>
                            
                            <!-- Indicateurs -->
                            <div class="grid grid-cols-2 gap-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">RSI:</span>
                                    <span x-text="analysis.indicators?.rsi?.toFixed(1) || 'N/A'"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">MACD:</span>
                                    <span x-text="analysis.indicators?.macd?.toFixed(5) || 'N/A'"></span>
                                </div>
                            </div>
                            
                            <!-- Raisonnement -->
                            <div class="mt-4 p-3 bg-gray-800 rounded-lg">
                                <div class="text-xs text-gray-400 mb-1">Raisonnement:</div>
                                <div class="text-sm" x-text="analysis.reasoning"></div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Logs -->
            <div class="trading-card rounded-xl p-6">
                <h3 class="text-lg font-semibold mb-4">üìã Journal d'Activit√©</h3>
                <div class="space-y-2 max-h-64 overflow-y-auto">
                    <template x-for="log in logs.slice().reverse()" :key="log.timestamp">
                        <div class="flex items-start space-x-3 p-2 bg-gray-800 rounded">
                            <div class="w-2 h-2 rounded-full mt-2" :class="getLogColor(log.type)"></div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium" x-text="log.message"></span>
                                    <span class="text-xs text-gray-400" x-text="formatTime(log.timestamp)"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <script>
        function ultimateTradingBot() {
            return {
                // √âtat
                mt5Connected: false,
                autoTrading: false,
                connecting: false,
                realAccount: false,
                
                // Configuration
                mt5Config: {
                    login: 1296306,
                    password: '@0JxCmJa',
                    server: 'FreshForex-MT5'
                },
                config: {
                    timeframe: 'M5',
                    symbols: ['EURUSD', 'GBPUSD', 'USDJPY'],
                    risk_per_trade: 0.02,
                    max_positions: 5,
                    take_trades: true
                },
                
                // Donn√©es
                accountInfo: null,
                analyses: [],
                logs: [],
                
                // Timeframes COMPLETS
                timeframes: [
                    { value: 'M1', label: '1 Minute', description: 'Scalping ultra-rapide' },
                    { value: 'M5', label: '5 Minutes', description: 'Scalping et day trading' },
                    { value: 'M15', label: '15 Minutes', description: 'Day trading' },
                    { value: 'M30', label: '30 Minutes', description: 'Day trading et swing' },
                    { value: 'H1', label: '1 Heure', description: 'Swing trading' },
                    { value: 'H4', label: '4 Heures', description: 'Swing et position' },
                    { value: 'D1', label: '1 Jour', description: 'Position trading' },
                    { value: 'W1', label: '1 Semaine', description: 'Trading long terme' },
                    { value: 'MN1', label: '1 Mois', description: 'Investissement long terme' }
                ],
                
                // M√©thodes
                init() {
                    this.connectWebSocket();
                    this.addLog('üöÄ Ultra Trading Bot initialis√© avec 9 timeframes', 'success');
                },
                
                connectWebSocket() {
                    // Simulation WebSocket pour la d√©mo
                    setTimeout(() => {
                        this.addLog('üì° WebSocket connect√©', 'success');
                    }, 1000);
                },
                
                selectTimeframe(timeframe) {
                    this.config.timeframe = timeframe;
                    this.updateConfig();
                    this.addLog(`‚è∞ Timeframe chang√© vers ${timeframe}`, 'info');
                },
                
                getCurrentTimeframeDescription() {
                    const tf = this.timeframes.find(t => t.value === this.config.timeframe);
                    return tf ? tf.description : 'Description non disponible';
                },
                
                async connectMT5() {
                    this.connecting = true;
                    this.addLog('üîå Connexion √† MT5...', 'info');
                    
                    try {
                        const response = await fetch('/api/mt5/connect', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.mt5Config)
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            this.mt5Connected = true;
                            this.accountInfo = result.account_info;
                            this.realAccount = result.account_info?.balance > 50000; // D√©tecte si compte r√©el
                            this.addLog(`‚úÖ MT5 connect√© - Solde: ${this.formatCurrency(result.account_info?.balance || 0)}`, 'success');
                        } else {
                            this.addLog(`‚ùå √âchec connexion MT5: ${result.message}`, 'error');
                        }
                    } catch (error) {
                        this.addLog(`‚ùå Erreur connexion: ${error.message}`, 'error');
                    } finally {
                        this.connecting = false;
                    }
                },
                
                async updateConfig() {
                    this.addLog(`‚öôÔ∏è Configuration mise √† jour - Timeframe: ${this.config.timeframe}`, 'info');
                },
                
                async startTrading() {
                    this.autoTrading = true;
                    this.addLog('üöÄ Trading automatique d√©marr√©', 'success');
                },
                
                async stopTrading() {
                    this.autoTrading = false;
                    this.addLog('‚èπÔ∏è Trading automatique arr√™t√©', 'warning');
                },
                
                async analyzeAll() {
                    this.addLog('üìä Analyse des march√©s...', 'info');
                    
                    // Simulation d'analyses
                    this.analyses = [
                        {
                            symbol: 'EURUSD',
                            timeframe: this.config.timeframe,
                            current_price: 1.08456,
                            action: 'STRONG_BUY',
                            confidence: 0.85,
                            reasoning: 'Trend bullish + RSI oversold + Volume √©lev√©',
                            indicators: { rsi: 28.5, macd: 0.00045 }
                        },
                        {
                            symbol: 'GBPUSD',
                            timeframe: this.config.timeframe,
                            current_price: 1.27234,
                            action: 'SELL',
                            confidence: 0.72,
                            reasoning: 'Trend bearish + R√©sistance + MACD bearish',
                            indicators: { rsi: 65.2, macd: -0.00023 }
                        },
                        {
                            symbol: 'USDJPY',
                            timeframe: this.config.timeframe,
                            current_price: 150.45,
                            action: 'HOLD',
                            confidence: 0.45,
                            reasoning: 'March√© lat√©ral + Signaux contradictoires',
                            indicators: { rsi: 52.1, macd: 0.00001 }
                        }
                    ];
                    
                    this.addLog(`‚úÖ Analyse termin√©e - ${this.analyses.length} symboles analys√©s`, 'success');
                },
                
                // Utilitaires
                formatCurrency(amount) {
                    return new Intl.NumberFormat('fr-FR', {
                        style: 'currency',
                        currency: 'USD'
                    }).format(amount);
                },
                
                formatTime(timestamp) {
                    return new Date(timestamp).toLocaleTimeString('fr-FR');
                },
                
                getActionColor(action) {
                    const colors = {
                        'STRONG_BUY': 'bg-green-500',
                        'BUY': 'bg-green-400',
                        'HOLD': 'bg-gray-400',
                        'SELL': 'bg-red-400',
                        'STRONG_SELL': 'bg-red-500'
                    };
                    return colors[action] || 'bg-gray-400';
                },
                
                getConfidenceColor(confidence) {
                    if (confidence >= 0.8) return 'bg-green-500';
                    if (confidence >= 0.6) return 'bg-yellow-500';
                    return 'bg-red-500';
                },
                
                getLogColor(type) {
                    const colors = {
                        'success': 'bg-green-400',
                        'error': 'bg-red-400',
                        'warning': 'bg-yellow-400',
                        'info': 'bg-blue-400'
                    };
                    return colors[type] || 'bg-gray-400';
                },
                
                addLog(message, type = 'info') {
                    this.logs.push({
                        timestamp: new Date(),
                        message: message,
                        type: type
                    });
                    
                    if (this.logs.length > 50) {
                        this.logs = this.logs.slice(-50);
                    }
                }
            };
        }
    </script>
</body>
</html>